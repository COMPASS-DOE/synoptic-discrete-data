---
title: "COMPASS_SynopticCB_Collate_SGAS_2024_Data"
author: "Stephanie J. Wilson"
date: "2025-08-29"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
```

#Read in and collate all the files in the Processed Data folder 
```{r}

files <- list.files(path = "Processed Data", pattern = "\\.csv$", full.names = TRUE)

# 3. Read and combine all CSVs
all_data <- files %>%
    lapply(function(file) {
    df <- read.csv(file)
    if ("Run_Date" %in% names(df)) {
      df$Run_Date <- as.character(df$Run_Date)
    }
    return(df)
  }) %>%
  bind_rows()

all_data <- all_data[ ,-1]

```

#Read in selected TMP data for GCW Upland - need to do this too...  
```{#r}

gcw_up <- read.csv("COMPASS_SynopticCB_GCW_UP_SGAS_2024.csv")


#pull out what we need 
gcw_up1 <- gcw_up %>%
  select( "Project", "Year","Month", "Sapflux_Tree_ID" ,
          "Sample_ID","CH4_ppm", "CH4_Flag", "CO2_ppm", "CO2_Flag")
head(gcw_up1)

#clean it up and add necessary columns
gcw_up1 <- gcw_up1 %>%
  mutate(Project = "COMPASS: Synoptic", 
         Region = "CB", 
         Site = "GCW", 
         Gas_Sample = "TGAS", 
         Zone = "UP", 
         Tree_Code = "SF") %>%
  mutate(Replicate = str_extract(Sapflux_Tree_ID, "\\d+")) %>%
  mutate(Tree_Info = case_when(
    Tree_Code == "DS" ~ "Dead Standing",
    Tree_Code == "SF" ~ "Sapflow Monitoring",
    TRUE ~ "Other"  # Optional: handles any values that aren't DS or SF
  )) %>%
  mutate(Status = case_when(
    Tree_Code == "DS" ~ "Dead Standing",
    Tree_Code == "SF" ~ "Living",
    TRUE ~ "Other"  
  )) %>%
  mutate(CH4_Flag = case_when(
    CH4_Flag == "Needs_Dilution" ~ "Over Std Curve Range",
    TRUE ~ "Within Std Curve Range"  
  )) %>%
  mutate(CO2_Flag = case_when(
    CO2_Flag == "Needs_Dilution" ~ "Over Std Curve Range",
    TRUE ~ "Within Std Curve Range"  
  ))

#Put them in order and grab what we need 
final_gcw_up <- gcw_up1 %>%
  select( "Project", "Region" , "Year","Month" ,"Site", "Zone", "Gas_Sample",
          "Sample_ID", "Tree_Code", "Replicate", "Status", "Tree_Info",
          "CH4_ppm", "CH4_Flag", "CO2_ppm", "CO2_Flag")

#combine the TMP data with the rest of the data: 
all_data_gcw <- rbind(all_data, final_gcw_up)

```

## Viz? and Write the 2022 file out to the folder 
```{r, echo=FALSE}


write.csv(all_data_gcw, "COMPASS_SynopticCB_SGAS_2024.csv")

```

