Pct_Diff = abs(Spike_Conc - Exp_Conc) / Mean_Conc * 100,
SD_Conc = sd(c(Spike_Conc, Exp_Conc)),
CV = (SD_Conc / Mean_Conc) * 100,
Spike_diff_flag = ifelse(CV < 20, "YES", "NO, check"),
Test = "Ammonia 2") %>%
ungroup()
df_spk_PO4_chk <- df_PO4_spk %>%
select(Pair_ID, Conc, Type) %>%
pivot_wider(
names_from = Type,
values_from = Conc,
values_fn = mean,  # in case there are duplicates
names_prefix = "" ) %>%
rename(
Spike_Conc = Auto_Spike,
OG_Conc = Original) %>%
filter(!is.na(Spike_Conc), !is.na(OG_Conc)) %>%
rowwise() %>%# keep only rows with both
mutate(
Exp_Conc = OG_Conc + PO4_Spk,
Mean_Conc = mean(c(Spike_Conc, Exp_Conc), na.rm = TRUE),
Pct_Diff = abs(Spike_Conc - Exp_Conc) / Mean_Conc * 100,
SD_Conc = sd(c(Spike_Conc, Exp_Conc)),
CV = (SD_Conc / Mean_Conc) * 100,
Spike_diff_flag = ifelse(CV < 20, "YES", "NO, check"),
Test = "o-PHOS 0.3") %>%
ungroup()
# Combining Auto Spike data frames
df_spk_combo <- bind_rows(df_spk_NOx_chk, df_spk_NH3_chk, df_spk_PO4_chk)
#add column for test ^^ aand then combine
#calculate the percent of check standards that are within the range based on the flag
NOx_spk_percent <- (sum(df_spk_NOx_chk$Spike_diff_flag == "YES")/nrow(df_spk_NOx_chk))*100
NH3_spk_percent <- (sum(df_spk_NH3_chk$Spike_diff_flag == "YES")/nrow(df_spk_NH3_chk))*100
PO4_spk_percent <- (sum(df_spk_PO4_chk$Spike_diff_flag == "YES")/nrow(df_spk_PO4_chk))*100
#spk flag report out
ifelse(NOx_spk_percent >= chks_flag,
">60% of Spikes have a CV <10% - PROCEED",
"<60% of Carbon Spikes have a CV <20% - REASSESS")
ifelse(NH3_spk_percent >= chks_flag,
">60% of Spikes have a CV <10% - PROCEED",
"<60% of Carbon Spikes have a CV <20% - REASSESS")
ifelse(PO4_spk_percent >= chks_flag,
">60% of Spikes have a CV <10% - PROCEED",
"<60% of Carbon Spikes have a CV <20% - REASSESS")
#plot spikes output as a bar graph to easily check - want any over 10% to be red need to work on this
NOx_spk_plot <- ggplot(data =df_spk_NOx_chk, aes(x =Pair_ID, y =CV, fill=Spike_diff_flag)) +
geom_bar(stat = 'identity') +
theme_classic() +
labs(x= "Sample ID", y="NOx N (mg/L)", title = "NOx Auto Spike CV") +
scale_fill_manual(values = c("YES" = "darkcyan", "NO, check" = "darkred")) +
theme(legend.position="none") +
guides(fill=guide_legend(title="CV Between Spks <20%"))+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
print(NOx_spk_plot)
NH3_spk_plot <- ggplot(data = df_spk_NH3_chk, aes(x =Pair_ID, y =CV, fill=Spike_diff_flag)) +
geom_bar(stat = 'identity') +
theme_classic() +
labs(x= "Sample ID", y="NH3 N(mg/L)", title = "NH3 Auto Spike CV") +
scale_fill_manual(values = c("YES" = "darkcyan", "NO, check" = "darkred")) +
theme(legend.position="none")  +
guides(fill=guide_legend(title="CV Between Spks <20%"))+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
PO4_spk_plot <- ggplot(data =df_spk_PO4_chk, aes(x =Pair_ID, y =CV, fill=Spike_diff_flag)) +
geom_bar(stat = 'identity') +
theme_classic() +
labs(x= "Sample ID", y="PO4 P(mg/L)", title = "PO4 Auto Spike CV") +
scale_fill_manual(values = c("YES" = "darkcyan", "NO, check" = "darkred")) +
theme(legend.position="none")  +
guides(fill=guide_legend(title="CV Between Spks <20%"))+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
Spk_Plots <- ggarrange(
NOx_spk_plot,
NH3_spk_plot,
PO4_spk_plot,   # (you had NH3 twice!)
nrow = 1,
ncol = 3,
common.legend = TRUE,
legend = "bottom")
print(Spk_Plots)
#write out a flag to the sample dataframe if more than 60% of the dups have CVs out of range
if (NOx_spk_percent <= chks_flag) {
df_all_cor$NOx_flag <- ifelse(
df_all_cor$NOx_flag != "",
paste0(df_all_cor$NOx_flag, "; NOx spikes out of range"),
"NOx spikes out of range"
)
}
if (NH3_spk_percent <= chks_flag) {
df_all_cor$NH3_flag <- ifelse(
df_all_cor$NH3_flag != "",
paste0(df_all_cor$NH3_flag, "; NH3 spikes out of range"),
"NH3 spikes out of range"
)
}
if (PO4_spk_percent <= chks_flag) {
df_all_cor$PO4_flag <- ifelse(
df_all_cor$PO4_flag != "",
paste0(df_all_cor$PO4_flag, "; PO4 spikes out of range"),
"PO4 spikes out of range"
)
}
##IVB can you build this out a bit so that it reports per test?
df_matrix <- df_spk_combo%>%
filter(str_detect(Pair_ID, "Abs_Chk"))
df_matrix_NOx <- df_matrix %>%
filter(str_detect(Test, "Vanadium"))
ifelse(
all(df_matrix_NOx$Spike_diff_flag == "YES"),
"NO NOx Matrix Effect, PROCEED",
">20% CV in ASW NOx matrix effect checks - REASSESS"
)
df_matrix_NH3 <- df_matrix %>%
filter(str_detect(Test, "Vanadium"))
ifelse(
all(df_matrix_NH3$Spike_diff_flag == "YES"),
"NO NH3 Matrix Effect, PROCEED",
">20% CV in ASW NH3 matrix effect checks - REASSESS"
)
df_matrix_PO4 <- df_matrix %>%
filter(str_detect(Test, "Vanadium"))
ifelse(
all(df_matrix_PO4$Spike_diff_flag == "YES"),
"NO PO4 Matrix Effect, PROCEED",
">20% CV in ASW PO4 matrix effect checks - REASSESS"
)
#write out a flag to the sample dataframe if more than 60% of the dups have CVs out of range
if (any(df_matrix$Spike_diff_flag[df_matrix$Test == "Vanadium NOx"] != "YES")) {
df_all_cor$NOx_flag <- ifelse(
df_all_cor$NOx_flag != "",
paste0(df_all_cor$NOx_flag, "; NOx matrix check out of range"),
"NOx matrix check out of range"
)
}
if (any(df_matrix$Spike_diff_flag[df_matrix$Test == "Ammonia 2"] != "YES")) {
df_all_cor$NOx_flag <- ifelse(
df_all_cor$NOx_flag != "",
paste0(df_all_cor$NOx_flag, "; NH3 matrix check out of range"),
"NH3 matrix check out of range"
)
}
if (any(df_matrix$Spike_diff_flag[df_matrix$Test == "o-PHOS 0.3"] != "YES")) {
df_all_cor$NOx_flag <- ifelse(
df_all_cor$NOx_flag != "",
paste0(df_all_cor$NOx_flag, "; PO4 matrix check out of range"),
"PO4 matrix check out of range"
)
}
#Pull out samples
samples <- df_all_cor %>%
filter(str_detect(Sample_Name, c("GCW|GWI|MSM|SWH")))
#Convert values based on the Test ID
samples <- samples %>%
mutate(
Conc_uM = case_when(
Test == "Vanadium NOx" ~ (((as.numeric(samples$Conc))/Con1)/N_mw)*Con2,
Test == "Ammonia 2" ~ (((as.numeric(samples$Conc))/Con1)/N_mw)*Con2,
Test == "o-PHOS 0.3" ~ (((as.numeric(samples$Conc))/Con1)/P_mw)*Con2,
TRUE ~ as.numeric(NA)  # fallback in case of unexpected value
),
# Replace negatives with 0 in 'value' and 'value_converted'
Conc = pmax(Conc, 0),
Conc_uM = pmax(Conc_uM, 0)
)
head(samples)
cat("Sample Flagging")
#Flagging data if the concentration is outside the standards range
samples_flagged <- samples %>%
mutate(
Conc_flag = case_when(
Test == "Vanadium NOx" & Conc < NOx_dl ~ "bdl",
Test == "Vanadium NOx" & Conc > NOx_top    ~ "adl",
Test == "Vanadium NOx"               ~ "Within_Range",
Test == "Ammonia 2" & Conc < NH3_dl ~ "bdl",
Test == "Ammonia 2" & Conc > NH3_top    ~ "adl",
Test == "Ammonia 2"                ~ "Within_Range",
Test == "o-PHOS 0.3" & Conc < PO4_dl  ~ "bdl",
Test == "o-PHOS 0.3" & Conc > PO4_top   ~ "adl",
Test == "o-PHOS 0.3"                ~ "Within_Range",
TRUE ~ NA_character_  # fallback for unexpected values
)
)
cat("Sample Processing")
df_all_clean <- samples %>%
filter(str_detect(Sample_Name, "GCW|GWI|MSM|SWH")) %>%
mutate(Run_Time = lubridate::mdy_hm(Run_Time)) %>%
separate(
col = Sample_Name,
sep = "_",
into = c("Site", "Samp_Time", "Zone", "Replicate", "Depth"),
remove = FALSE) %>%
mutate(Samp_Time = ym(Samp_Time)) %>%
mutate(
Site = case_when(
Site == "GCW" ~ "GCReW",
Site == "GWI" ~ "Goodwin Island",
Site == "MSM" ~ "Moneystump",
Site == "SWH" ~ "Sweethall",
TRUE ~ Site),
`Zone` = case_when(
`Zone` == "UP" ~ "Upland",
`Zone` == "TR" ~ "Transition",
`Zone` == "WC" ~ "Wetland",
`Zone` == "SWAMP" ~ "Swamp",
`Zone` == "SW" ~ "Surface Water",
TRUE ~ `Zone`
))
cat("Check Sample IDs with Metadata")
#check to see if all samples are present in the metadata
all_present <- all(samples_flagged$Sample_Name %in% nutr_metadata$NUTR_ID)
if (all_present) {
message("All sample IDs are present in metadata.")
} else {
message("Some sample IDs are missing from metadata.")
# Optional: Which ones are missing?
missing_ids <- setdiff(samples_flagged$Sample_Name, nutr_metadata$NUTR_ID)
print(missing_ids)
}
nutr_metadata_selected <- nutr_metadata %>%
select(NUTR_ID, Year, Month, Day, Depth_cm, Lysimeter, Time..24hr., Time.Zone_EDT.EST,  Field.Notes)
#merge metadata with sample run data
merged_data <- samples_flagged %>%
left_join(nutr_metadata_selected, by = c("Sample_Name" = "NUTR_ID"))
df_all_clean <- merged_data %>%
#filter(str_detect(Sample_Name, "GCW|GWI|MSM|SWH")) %>%
#mutate(Run_Time = lubridate::mdy_hm(Run_Time)) %>%
separate(
col = Sample_Name,
sep = "_",
into = c("Site", "Samp_Time", "Zone", "Replicate", "Depth"),
remove = FALSE) %>%
mutate(Samp_Time = ym(Samp_Time))
View(samples_flagged)
View(dat_NH3_PO4_1)
#let you know which section you are in
cat("Run Information: Input by User")
#set the run date & user name
run_date <- "20230603"
sample_year <- 2023
sample_month <- 04
user <- "Stephanie Wilson"
#identify the files you want to read in
NOx_file_1 <- "Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv"
NH3_PO4_file_1 <- "Raw Data/SEAL_COMPASS_Synoptic_NH3_PO4_April2023_1.csv"
#  NH3_PO4_file_2 <- "Raw Data/SEAL_COMPASS_Synoptic_NH3_PO4_Aug2023_2.csv"
#combine files if multople
#  NH3_PO4_file <- rbind(NH3_PO4_file_1, NH3_PO4_file_2)
# Define the file path for QAQC log file - NO Need to change just check year
file_path <- "Raw Data/SEAL_COMPASS_Synoptic_QAQC_Log_2023.csv"
final_path <- "Processed Data/COMPASS_Synoptic_Nutrients_202304.csv"
#record any notes about the run or anything other info here:
run_notes <- "There are two sample names we suspect were input incorrectly, they are listed below and have been checked against metadata"
#duplicate sample names to be changed
#list the sample iDs that are messed up and create a list with run number as well so that we can change them below
wrong_names <- c("GCW_202304_TR_LysC_45cm", "GCW_202304_TR_LysA_20cm_8", "GWI_202304_UP_LysA_20cm", "GWI_202304_UP_LysA_20cm")
wrong_nums <- c(20, 16, 46, 44)
correct_names <- c("GCW_202304_TR_LysB_45cm", "GCW_202304_TR_LysA_20cm", "GWI_202304_UP_LysA_10cm", "GWI_202304_UP_LysA_10cm")
#can't determine from metadata - for now unsure
remove_names <- c("GCW_202304_TR_LysA_20cm", "GCW_202304_TR_LysA_20cm", "GCW_202304_TR_LysB_20cm_13", "GCW_202304_TR_LysB_20cm_13")
#couldn't tell which onethis is from the metadata, no A_10cm which is what we thought marked on the sheet, need to check sample vials in            freezer to see if we have a A_10cm from GCW_TR to be sure
remove_nums <- c(15, 13, 21, 19 )
#Set up file path for metadata
#downloaded metadata csv - downloaded from Google drive as csv for this year
#https://docs.google.com/spreadsheets/d/1HCAN0_q6y17x0RUXVzID09hVal-RfwWc/edit?usp=sharing&ouid=108994740386869376571&rtpof=true&sd=true
Raw_Metadata = "Raw Data/COMPASS_SynopticCB_PW_SampleLog_2023.csv"
cat("Visualize Data")
### Nitrite + Nitrate
NOx_forplot <- df_all_clean %>%
filter(Test == "Vanadium NOx")
#group the data for plotting
NOx_forplot <- NOx_forplot %>%
group_by(Site) %>%
mutate(row_num = factor(row_number())) %>%  # create row_num as factor per group
ungroup()
viz_NOx_plot <-  ggplot(data = NOx_forplot, aes(x = factor(row_num), y = Conc, fill=Zone)) +
geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) +
facet_grid(~ Site, scales="free_x") +
scale_fill_manual(values = c("UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6")) +
theme_classic() +
labs(x= " ", y="NOx (mg/L)", title="Porewater NOx") +
theme(legend.position = "none") +
scale_x_discrete(drop = TRUE)+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
### Ammonia
NH3_forplot <- df_all_clean %>%
filter(Test == "Ammonia 2")
#group the data for plotting
NH3_forplot <- NH3_forplot %>%
group_by(Site) %>%
mutate(row_num = factor(row_number())) %>%  # create row_num as factor per group
ungroup()
viz_NH3_plot <- ggplot(data = NH3_forplot, aes(x = factor(row_num), y = Conc, fill=Zone)) +
geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) +
facet_grid(~ Site, scales="free_x") +
scale_fill_manual(values = c("UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6")) +
theme_classic() +
labs(x= " ", y="H3 (mg/L)", title="Porewater NH3") +
theme(legend.position = "none") +
scale_x_discrete(drop = TRUE)+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
### Phosphate
PO4_forplot <- df_all_clean %>%
filter(Test == "o-PHOS 0.3")
#group the data for plotting
PO4_forplot <- PO4_forplot %>%
group_by(Site) %>%
mutate(row_num = factor(row_number())) %>%  # create row_num as factor per group
ungroup()
viz_PO4_plot <- ggplot(data = PO4_forplot, aes(x = factor(row_num), y = Conc, fill=Zone)) +
geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) +
facet_grid(~ Site, scales="free_x") +
scale_fill_manual(values = c("UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6")) +
theme_classic() +
labs(x= " ", y="PO4 (mg/L)", title="Porewater PO4") +
theme(legend.position = "none") +
scale_x_discrete(drop = TRUE)+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
Viz_Plots <- ggarrange(
viz_NOx_plot,
viz_NH3_plot,
viz_PO4_plot,   # (you had NH3 twice!)
nrow = 1,
ncol = 3,
common.legend = TRUE,
legend = "bottom")
print(Viz_Plots)
cat("Export Processed Data")
#pivot the data set wider to make it wide format
final_data1 <- df_all_clean %>%
pivot_wider(
id_cols = Sample_Name,
names_from = Test,
values_from = Conc,
names_glue = "{Test}_Conc"
)
final_data2 <- df_all_clean %>%
pivot_wider(
id_cols = Sample_Name,
names_from = Test,
values_from = Conc_uM,
names_glue = "{Test}_Conc_uM"
)
final_data3 <- df_all_clean %>%
pivot_wider(
id_cols = Sample_Name,
names_from = Test,
values_from = Conc_flag,
names_glue = "{Test}_Conc_flag"
)
#take out only the columns we want to merge
df_all_clean_cols <- df_all_clean %>%
select(Sample_Name, Site, Zone, Depth, Depth_cm, Lysimeter,
Year, Month, Day, Time..24hr., Time.Zone_EDT.EST,
NOx_flag, NH3_flag, PO4_flag,
Field.Notes)
df_all_clean_cols_one_row <- df_all_clean_cols %>%
group_by(Sample_Name) %>%
slice(1) %>%  # or use summarise() if you want to aggregate
ungroup()
#merge these together
data_list <- list(df_all_clean_cols_one_row, final_data1, final_data2, final_data3)
final_data4 <- reduce(data_list, full_join, by = c("Sample_Name"))
#Add project information
final_data_labeled <- final_data4 %>%
mutate(
Project = "COMPASS: Synoptic",   # new column with same value on every row
Region = "CB",
Run_notes = run_notes,
Analysis_rundate = print(run_date)# new column with notes about the run
)
#Prepare data to be exported
final_data <- final_data_labeled %>%
rename(
Site = Site,
Sample_ID = Sample_Name,
Time = Time..24hr.,
Time_Zone = Time.Zone_EDT.EST,
Replicate = Lysimeter,
NOx_Conc_mgL = `Vanadium NOx_Conc`,
NOx_Conc_uM = `Vanadium NOx_Conc_uM`,
NOx_Conc_Flag = `Vanadium NOx_Conc_flag`,
NOx_QAQC_Flag = NOx_flag,
NH3_Conc_mgL = `Ammonia 2_Conc`,
NH3_Conc_uM = `Ammonia 2_Conc_uM`,
NH3_Conc_Flag =`Ammonia 2_Conc_flag`,
NH3_QAQC_Flag = NH3_flag,
PO4_Conc_mgL = `o-PHOS 0.3_Conc`,
PO4_Conc_uM = `o-PHOS 0.3_Conc_uM`,
PO4_Conc_Flag =`o-PHOS 0.3_Conc_flag`,
PO4_QAQC_Flag = PO4_flag,
Field_notes = Field.Notes
# add more rename pairs as needed
) %>%
select(Project, Region, Site, Zone, Replicate, Depth_cm,
Sample_ID, Year, Month, Day, Time, Time_Zone,
NOx_Conc_mgL, NOx_Conc_uM, NOx_Conc_Flag, NOx_QAQC_Flag,
NH3_Conc_mgL, NH3_Conc_uM, NH3_Conc_Flag, NH3_QAQC_Flag,
PO4_Conc_mgL, PO4_Conc_uM, PO4_Conc_Flag, PO4_QAQC_Flag,
Analysis_rundate,  Run_notes, Field_notes)
#Write out data frame
#write.csv(final_data, final_path)
View(final_data)
#let you know which section you are in
cat("Run Information: Input by User")
#set the run date & user name
run_date <- "20230603"
sample_year <- 2023
sample_month <- 04
user <- "Stephanie Wilson"
#identify the files you want to read in
NOx_files <- c("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv")
NH3_PO4_files <- c("Raw Data/SEAL_COMPASS_Synoptic_NH3_PO4_April2023_1.csv")
#create a list of the files above
#file_list <- (NOx_file_1, NH3_PO4_file_1)
# Define the file path for QAQC log file - NO Need to change just check year
file_path <- "Raw Data/SEAL_COMPASS_Synoptic_QAQC_Log_2023.csv"
final_path <- "Processed Data/COMPASS_Synoptic_Nutrients_202304.csv"
#record any notes about the run or anything other info here:
run_notes <- "There are two sample names we suspect were input incorrectly, they are listed below and have been checked against metadata"
#duplicate sample names to be changed
#list the sample iDs that are messed up and create a list with run number as well so that we can change them below
wrong_names <- c("GCW_202304_TR_LysC_45cm", "GCW_202304_TR_LysA_20cm_8", "GWI_202304_UP_LysA_20cm", "GWI_202304_UP_LysA_20cm")
wrong_nums <- c(20, 16, 46, 44)
correct_names <- c("GCW_202304_TR_LysB_45cm", "GCW_202304_TR_LysA_20cm", "GWI_202304_UP_LysA_10cm", "GWI_202304_UP_LysA_10cm")
#can't determine from metadata - for now unsure
remove_names <- c("GCW_202304_TR_LysA_20cm", "GCW_202304_TR_LysA_20cm", "GCW_202304_TR_LysB_20cm_13", "GCW_202304_TR_LysB_20cm_13")
#couldn't tell which onethis is from the metadata, no A_10cm which is what we thought marked on the sheet, need to check sample vials in            freezer to see if we have a A_10cm from GCW_TR to be sure
remove_nums <- c(15, 13, 21, 19 )
#Set up file path for metadata
#downloaded metadata csv - downloaded from Google drive as csv for this year
#https://docs.google.com/spreadsheets/d/1HCAN0_q6y17x0RUXVzID09hVal-RfwWc/edit?usp=sharing&ouid=108994740386869376571&rtpof=true&sd=true
Raw_Metadata = "Raw Data/COMPASS_SynopticCB_PW_SampleLog_2023.csv"
tinytex::install_tinytex()
detach("package:tinytex", unload = TRUE)
library(tinytex)
#let you know which section you are in
cat("Setup")
#a link to the Gitbook or whatever protocol you are using for this analysis
#Maybe using pacman instead?
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
dplyr,
purrr,
ggplot2,
ggpubr,
tidyr,
tidyverse,
tinytex,
stringr,
readr,
broom)
#Coefficients / constants that are needed for calculations
N_mw <- 14.0067    # molecular weight of N
P_mw <- 30.973762  # molecular weight of P
Con1 <- 1000       # conversion factor value
Con2 <- 1000000    # conversion factor value
#Detection limit and top standards for flagging
NOx_dl <- 0.025  #mgL
NH3_dl <- 0.02  #mgL
PO4_dl <- 0.003 #mgL
NOx_top <- 1  #mgL
NH3_top <- 2  #mgL
PO4_top <- 0.3 #mgL
#Check Standard concnetrations
NOx_CCV <- 0.5
NH3_CCV <- 1.0
PO4_CCV <- 0.15
#Spike Concentrations
NOx_Spk <- 0.5 #ppm or mg/L
NH3_Spk <- 1
PO4_Spk <- 0.152
#expected ranges for sample concentrations used for flags
r2_cutoff = 0.990
chk_flag = 0.10
chk_conc_flag = 15 #cutoff level for percent difference of check stds vs. expected concentration
chks_flag = 60
# min_conc = int
# max_conc = int
# cv_flag = 10%
# rep_flag = 10%
#Flag that we
rep_flag = 25 #this is a 25% error between samples
#blank_flag is calculated based on samples later in this code
#check standard concentrations
# chk_std = 10
#any reference to other code
viz_NH3_plot <- ggplot(data = NH3_forplot, aes(x = factor(row_num),
y = Conc, fill=Zone, color="black")) +
geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) +
facet_grid(~ Site, scales="free_x") +
scale_fill_manual(values = c("UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6")) +
theme_classic() +
labs(x= " ", y="H3 (mg/L)", title="Porewater NH3") +
theme(legend.position = "none") +
scale_x_discrete(drop = TRUE)+
theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
print(viz_NH3_plot)
