geom_boxplot() +
facet_grid( ~ Site, scales = "free_x") +
scale_x_discrete(drop = TRUE) +
scale_fill_manual(values = c(
"Upland" = "#20063B",
"Transition" = "#FFBC42",
"Swamp" = "darkgrey",
"Wetland" = "#419973",
"Surface Water" = "#25ABE6"
), labels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water")) +
theme_classic() +
labs(x = " ", y = "Sulfate (mM)", title = "Samples: Sulfate") +
theme(
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+
theme(text = element_text(size = 25))+
theme(axis.ticks.x = element_line(linewidth = 1))+
theme(axis.ticks.length.x = unit(0.25, "cm"))+
#scale_x_discrete(labels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water"))+
theme(legend.position = "none")
viz_so4_boxplot
# ggarrange(viz_cl_plot, viz_so4_plot, nrow=2, ncol=1)
# Save as a PNG
png("COMPASS_SynopticCB_Cl_alldata.png", width = 2000, height = 1200, res = 300)
print(viz_cl_boxplot)  # For ggplot objects, use print()
dev.off()
# Save as a PNG
png("COMPASS_SynopticCB_SO4_alldata.png", width = 2000, height = 1200, res = 300)
print(viz_so4_boxplot)  # For ggplot objects, use print()
dev.off()
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(lubridate)
files <- list.files(path = "Processed Data", pattern = "\\.csv$", full.names = TRUE)
data_list <- lapply(files, function(f) {
df <- read.csv(f, stringsAsFactors = FALSE)  # avoids factors
df$Site <- as.character(df$Site)             # ensures character
return(df)
})
# Combine all files
all_data <- bind_rows(data_list)
#remove the first unneeded column
all_data <- all_data[, -which(names(all_data) == "X")]
View(all_data)
#rename the zone identifiers because we had renamed them starting in 2024
all_data <- all_data %>%
mutate(
Zone = case_when(
Site == "SWH" & Zone == "UP" ~ "SWAMP",
Site == "SWH" & Zone == "UPCON" ~ "UP",
TRUE ~ Zone  # keep everything else unchanged
)
)
#also change these IDs in the sample IDs so that it is not confusing later
all_data <- all_data %>%
mutate(
Sample_ID = case_when(
Site == "SWH" & Zone == "UP" ~ str_replace_all(Sample_ID, "_UP_", "_SWAMP_"),
Site == "SWH" & Zone == "UPCON" ~ str_replace_all(Sample_ID, "_UPCON_", "_UP_"),
TRUE ~ Sample_ID  # keep everything else unchanged
)
)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(lubridate)
files <- list.files(path = "Processed Data", pattern = "\\.csv$", full.names = TRUE)
data_list <- lapply(files, function(f) {
df <- read.csv(f, stringsAsFactors = FALSE)  # avoids factors
df$Site <- as.character(df$Site)             # ensures character
return(df)
})
# Combine all files
all_data <- bind_rows(data_list)
#remove the first unneeded column
all_data <- all_data[, -which(names(all_data) == "X")]
#rename the zone identifiers because we had renamed them starting in 2024
all_data <- all_data %>%
mutate(
Zone = case_when(
Site == "SWH" & Zone == "UP" ~ "SWAMP",
Site == "SWH" & Zone == "UPCON" ~ "UP",
TRUE ~ Zone  # keep everything else unchanged
)
)
#also change these IDs in the sample IDs so that it is not confusing later
all_data <- all_data %>%
mutate(
Sample_ID = case_when(
Site == "SWH" & Zone == "SWAMP" ~ str_replace_all(Sample_ID, "_UP_", "_SWAMP_"),
Site == "SWH" & Zone == "UP" ~ str_replace_all(Sample_ID, "_UPCON_", "_UP_"),
TRUE ~ Sample_ID  # keep everything else unchanged
)
)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(lubridate)
files <- list.files(path = "Processed Data", pattern = "\\.csv$", full.names = TRUE)
data_list <- lapply(files, function(f) {
df <- read.csv(f, stringsAsFactors = FALSE)  # avoids factors
df$Site <- as.character(df$Site)             # ensures character
return(df)
})
# Combine all files
all_data <- bind_rows(data_list)
#remove the first unneeded column
all_data <- all_data[, -which(names(all_data) == "X")]
#rename the zone identifiers because we had renamed them starting in 2024
all_data <- all_data %>%
mutate(
Zone = case_when(
Site == "SWH" & Zone == "UP" ~ "SWAMP",
Site == "SWH" & Zone == "UPCON" ~ "UP",
TRUE ~ Zone  # keep everything else unchanged
)
)
#also change these IDs in the sample IDs so that it is not confusing later
all_data <- all_data %>%
mutate(
Sample_ID = case_when(
Site == "SWH" & Zone == "SWAMP" ~ str_replace_all(Sample_ID, "_UP_", "_SWAMP_"),
Site == "SWH" & Zone == "UP" ~ str_replace_all(Sample_ID, "_UPCON_", "_UP_"),
TRUE ~ Sample_ID  # keep everything else unchanged
)
)
#Put together the final lysimeter data
final_data_lys <- all_data %>%
rename(Analysis_rundate = Analysis_runtime) %>%
select(
Project, Region, Site, Zone, Replicate, Depth_cm,
Sample_ID, Year, Month, Day, Time, Time_Zone,
ic_mgL, ic_uM, ic_flag,
Analysis_rundate,  Run_notes, Field_notes
# list columns in the order you want them
)
data_plotting <- rbind(all_data)
#Order by Zone from Upland to Surface Water
data_plotting$Zone = factor(data_plotting$Zone, levels = c("UP", "SWAMP", "TR", "WC", "SW"))
data_plotting <- data_plotting[order(data_plotting$Zone), ]
#Order by Site from SWH, GCW, MSM, GWI order, which is oligohaline to polyhaline
data_plotting$Site = factor(data_plotting$Site, levels = c("SWH", "GCW", "MSM", "GWI"))
data_plotting <- data_plotting[order(data_plotting$Site), ]
#Plot samples to get a first look at concentrations (sanity check)
#group the data for plotting
data_plotting_all <- data_plotting %>%
group_by(Site, Zone) %>%
mutate(row_num = factor(row_number())) %>%  # create row_num as factor per group
ungroup()
data_plotting_all$Date <- as.Date(paste(data_plotting_all$Year, data_plotting_all$Month, data_plotting_all$Day, sep = "-"))
data_plotting_all$Month_name <- month.name[data_plotting_all$Month]
#Plot data and change colors based on Zone:
viz_dic_plot <- ggplot(data_plotting_all, aes(x = as.character(Month_name), y = ic_mgL, fill = Zone)) +
geom_bar(stat = "identity", position = position_dodge2(preserve = "total")) +
facet_grid( ~ Site, scales="free") +
scale_fill_manual(values = c(
"UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6"
)) +
theme_classic() +
labs(x = " ", y = "DIC (mg/L)", title = "Samples: DIC") +
theme(
panel.spacing = unit(.05, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
theme(text = element_text(size = 20))
print(viz_dic_plot)
#write out all the lysimeter sample data
write.csv(final_data_lys, "COMPASS_SynopticCB_PW_DIC_2023.csv")
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(openxlsx)
#read in 2022 Dionex Data:
dat22 <- read.csv("2022/COMPASS_SynopticCB_PW_DIC_2022.csv")
# head(dat22)
#read in 2023 Dionex Data:
dat23 <- read.csv("2023/COMPASS_SynopticCB_PW_DIC_2023.csv")
# head(dat23)
#read in 2024 Dionex Data:
dat24 <- read.csv("2024/COMPASS_SynopticCB_PW_DIC_2024.csv")
# head(dat24)
all_dat <- rbind(dat22, dat23, dat24)
all_dat <- all_dat %>%
select(
Project, Region, Site, Zone, Replicate, Depth_cm,
Sample_ID, Year, Month, Day, Time, Time_Zone,
ic_mgL, ic_uM, ic_flag,
Analysis_rundate,  Run_notes, Field_notes
# list columns in the order you want them
)
#pull the column names from the all_dat dataframe and create a new dataframe with them
metadat <- data.frame(Column_Names = colnames(all_dat))
metadat
metadat$Description <- ""
metadat$Units <- ""
metadat$Instrument_ifapplicable <- ""
#add information about each line:
metadat$Description <- c("Project name",
"Region samples originated from: CB = Chesapeake Bay",
"Sample identifier used in laboratory and field",
"Year (YYYY) of sample collection",
"Month (#) of sample collection",
"Day (#) of sample collection",
"Time (HH:MM) of sample collection",
"Time Zone of sample collection",
"Name of sampling transect location (GCW, SWH, MSM, GWI), see dataset locations for coordinates",
"Zone within space-for-time transect (UP=Upland, SWAMP=Swamp, TR=Transition, WC=Wetland Control, SW=Surface Water)",
"Lysimeter or sample replicate id (A-C)",
"Depth in centimeters from which water sample was taken",
"Dissolved inorganic Carbon (DIC) concentration in mg/L",
"Dissolved inorganic Carbon (DIC) concentration in uM",
"QAQC Flags generated during checks of standards, blanks, dups, and spks",
"The date that samples were run on the Shimadzu TOC-V",
"Any notes generated during QAQC",
"Notes generated during field sample collection")
metadat$Units <-       c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"cm",
"mg/L",
"uM",
"NA",
"NA",
"NA",
"NA")
metadat$Instrument_ifapplicable <-
c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"TOC-V (Shimadzu)",
"TOC-V (Shimadzu)",
"NA",
"NA",
"NA",
"NA")
#write out a csv of all the data to the main folder:
write.csv(all_dat, "COMPASS_SynopticCB_PW_DIC_AllData.csv")
#write out a csv of the metadata associated with the data:
write.csv(metadat, "COMPASS_SynopticCB_PW_DIC_Metadata.csv")
data_plotting <- all_dat
#Order by Zone from Upland to Surface Water
data_plotting$Zone = factor(data_plotting$Zone, levels = c("UP", "SWAMP", "TR", "WC", "SW"))
data_plotting <- data_plotting[order(data_plotting$Zone), ]
#Order by Site from SWH, GCW, MSM, GWI order, which is oligohaline to polyhaline
data_plotting$Site = factor(data_plotting$Site, levels = c("SWH", "GCW", "MSM", "GWI"))
data_plotting <- data_plotting[order(data_plotting$Site), ]
# #Order by Year from 2022-2024
# data_plotting$Site = factor(data_plotting$Site, levels = c("SWH", "GCW", "MSM", "GWI"))
# data_plotting <- data_plotting[order(data_plotting$Site), ]
#Plot samples to get a first look at concentrations (sanity check)
#group the data for plotting
data_plotting_all <- data_plotting %>%
group_by(Site, Zone) %>%
mutate(row_num = factor(row_number())) %>%  # create row_num as factor per group
ungroup()
data_plotting_all$Date <- as.Date(paste(data_plotting_all$Year, data_plotting_all$Month, data_plotting_all$Day, sep = "-"))
#Plot data and change colors based on Zone:
viz_cl_plot <- ggplot(data_plotting_all, aes(x = as.character(Year), y = ic_mgL, fill = Zone)) +
geom_bar(stat = "identity", position = position_dodge2(preserve = "total")) +
facet_grid( ~ Site, scales="free") +
scale_fill_manual(values = c(
"UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6"
)) +
theme_classic() +
labs(x = " ", y = "DIC (mg/L)", title = "Synoptic CB Porewater: DIC") +
theme(
panel.spacing = unit(.05, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
theme(text = element_text(size = 20))
viz_cl_plot
##Make Date Column with just Year and Month for Sample ID
all_dat_dates <- data_plotting %>%
mutate(
YearMonth = if_else(
Month < 10,
# Modify the string:
YearMonth <- paste(data_plotting$Year, data_plotting$Month, sep = "-0"),
YearMonth <- paste(data_plotting$Year, data_plotting$Month, sep = "-"),
)
)
##Summarize SO4 and Cl by Date, Site, and Zone
DIC_avg <- all_dat_dates %>%
group_by(Month, Year, Site, Zone) %>%
dplyr::summarize(mean_DIC = mean(ic_mgL, na.rm=TRUE),
sd_DIC = sd(ic_mgL, na.rm=TRUE),
YearMonth = first(YearMonth))
# Concatenate with a day (e.g., "01" for the first day)
DIC_avg$Date <- paste0(DIC_avg$YearMonth, "-01")
# Convert to Date object
DIC_avg$Date <- as.Date(DIC_avg$Date)
# Define the specific date breaks you want to display
specific_breaks <- as.Date(c("2022-01-01", "2023-01-01", "2024-01-01"))
viz_dic_plot_avgs <- ggplot(DIC_avg, aes(x = Date, y = mean_DIC, color = Zone, group = Zone)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = mean_DIC - sd_DIC, ymax = mean_DIC + sd_DIC), width = 0.2) +
geom_line() +
facet_grid( ~ Site, scales="free_y") +
scale_color_manual(values = c(
"UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6"
)) +
theme_classic() +
labs(x = "Date", y = "DIC (mg/L)", title = "Synoptic CB Porewater: DIC") +
theme(
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
# theme(axis.text.x = element_text(angle = 90, hjust = 0.5))+
theme(text = element_text(size = 30))+
scale_x_date(breaks = specific_breaks, date_labels = "%Y", expand = expansion(mult = c(0.18, 0.05)))+
theme(axis.ticks.x = element_line(linewidth = 1))+
theme(axis.ticks.length.x = unit(0.25, "cm"))
viz_dic_plot_avgs
##Summarize SO4 and Cl by Date, Site, and Zone
DIC_avg_depth <- all_dat_dates %>%
group_by(Month, Year, Site, Zone, Depth_cm) %>%
dplyr::summarize(mean_DIC = mean(ic_mgL, na.rm=TRUE),
sd_DIC = sd(ic_mgL, na.rm=TRUE),
YearMonth = first(YearMonth))
# Concatenate with a day (e.g., "01" for the first day)
DIC_avg_depth$Date <- paste0(DIC_avg_depth$YearMonth, "-01")
# Convert to Date object
DIC_avg_depth$Date <- as.Date(DIC_avg_depth$Date)
# Define the specific date breaks you want to display
specific_breaks <- as.Date(c("2022-01-01", "2023-01-01", "2024-01-01"))
viz_dic_plot_depth <- ggplot(DIC_avg_depth, aes(x = Date, y = mean_DIC, color = Zone, group = Zone, shape = as.character(Depth_cm))) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = mean_DIC - sd_DIC, ymax = mean_DIC + sd_DIC), width = 0.2) +
geom_line() +
facet_grid( ~ Site, scales="free_y") +
scale_color_manual(values = c(
"UP" = "#20063B",
"TR" = "#FFBC42",
"SWAMP" = "darkgrey",
"WC" = "#419973",
"SW" = "#25ABE6"
)) +
theme_classic() +
labs(x = " ", y = "DIC (mg/L)", title = "Synoptic CB Porewater: DIC") +
theme(
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
# theme(axis.text.x = element_text(angle = 90, hjust = 0.5))+
theme(text = element_text(size = 30))+
scale_x_date(breaks = specific_breaks, date_labels = "%Y", expand = expansion(mult = c(0.18, 0.05))) +
labs(fill = "Zone", shape = "Depth (cm)")+
theme(axis.ticks.x = element_line(linewidth = 1))+
theme(axis.ticks.length.x = unit(0.25, "cm"))
viz_dic_plot_depth
all_dat_dates <- all_dat_dates %>%
mutate(
Zone_1 = case_when(
Zone == "UP" ~ "Upland",
Zone == "SWAMP" ~ "Swamp",
Zone == "TR" ~ "Transition",
Zone == "WC" ~ "Wetland",
Zone == "SW" ~ "Surface Water",
TRUE ~ Zone  # keep everything else unchanged
)
) %>%
mutate(Zone_1 = factor(Zone_1, levels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water")))
##Summarize SO4 and Cl by Date, Site, and Zone
viz_dic_boxplot <- ggplot(all_dat_dates, aes(x = Zone_1, y = ic_mgL, fill = Zone_1, group = Zone_1)) +
geom_boxplot() +
facet_grid( ~ Site, scales = "free_x") +
scale_x_discrete(drop = TRUE) +
scale_fill_manual(values = c(
"Upland" = "#20063B",
"Transition" = "#FFBC42",
"Swamp" = "darkgrey",
"Wetland" = "#419973",
"Surface Water" = "#25ABE6"
), labels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water")) +
theme_classic() +
labs(x = " ", y = "DIC (mg/L)", title = "Synoptic CB Porewater: DIC") +
theme(
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+
theme(text = element_text(size = 12))+
theme(axis.ticks.x = element_line(linewidth = 1))+
theme(axis.ticks.length.x = unit(0.25, "cm"))+
#scale_x_discrete(labels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water"))+
theme(legend.position = "none")
viz_dic_boxplot
# Save as a PNG
png("COMPASS_SynopticCB_DIC_alldata.png", width = 2000, height = 1200, res = 300)
print(viz_dic_boxplot)  # For ggplot objects, use print()
dev.off()
all_dat_dates <- all_dat_dates %>%
mutate(
Zone_1 = case_when(
Zone == "UP" ~ "Upland",
Zone == "SWAMP" ~ "Swamp",
Zone == "TR" ~ "Transition",
Zone == "WC" ~ "Wetland",
Zone == "SW" ~ "Surface Water",
TRUE ~ Zone  # keep everything else unchanged
)
) %>%
mutate(Zone_1 = factor(Zone_1, levels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water")))
##Summarize SO4 and Cl by Date, Site, and Zone
viz_dic_boxplot <- ggplot(all_dat_dates, aes(x = Zone_1, y = ic_mgL, fill = Zone_1, group = Zone_1)) +
geom_boxplot() +
facet_grid( ~ Site, scales = "free_x") +
scale_x_discrete(drop = TRUE) +
scale_fill_manual(values = c(
"Upland" = "#20063B",
"Transition" = "#FFBC42",
"Swamp" = "darkgrey",
"Wetland" = "#419973",
"Surface Water" = "#25ABE6"
), labels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water")) +
theme_classic() +
labs(x = " ", y = "DIC (mg/L)", title = "Synoptic CB Porewater: DIC") +
theme(
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 1)) +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+
theme(text = element_text(size = 12))+
theme(axis.ticks.x = element_line(linewidth = 1))+
theme(axis.ticks.length.x = unit(0.25, "cm"))+
#scale_x_discrete(labels = c("Upland", "Swamp", "Transition", "Wetland", "Surface Water"))+
theme(legend.position = "none")
viz_dic_boxplot
# Save as a PNG
png("COMPASS_SynopticCB_DIC_alldata.png", width = 2000, height = 1200, res = 300)
print(viz_dic_boxplot)  # For ggplot objects, use print()
dev.off()
#identify section
cat("Setup")
#Link to the protocol used for analysis
#steph will add this soon
#Packages that are required
lapply(c(
"dplyr", "ggplot2", "ggpubr", "stringr",
"purrr", "tidyverse", "here", "broom",
"googledrive", "googlesheets4"),
library, character.only = TRUE)
#any coefficients / constants that are needed for calculations
mw_c <- 12.011   #molecular weight of Carbon
mw_n <- 14.0067  #molecular weight of Nitrogen
Con1 <- 1000       # conversion factor value
Con2 <- 1000000    # conversion factor value
#Flag that we
r2_cutoff = 0.98  #this is the level below which we want to rerun or consider a curve
chk_flag = 0.10   #for the RSD (relative standard deviation)
chk_conc_flag = 15 #this is the level cutoff for percent difference of check standards vs. the concentration they are meant to be
chks_flag = 50 #this is the percent of chks we want to have a CV less than 10, usually 60
rep_flag = 25 #this is a 25% error between samples
#blank_flag - calculated based on samples later in this code as lower 25% quantile of sample concentrations
#check standard concentrations - Update if running different checks:
chk_std_low_c = 1
chk_std_high_c = 50
chk_std_low_n = 1
chk_std_high_n = 2
#Top standard Concentrations- Update if running different standard curve:
top_std_c = 100
top_std_n = 3
#Set time zone
common_tz = "Etc/GMT+5"
Sys.setenv(TZ = "America/New_York")
#plot indicators
site_order <- c('GCW', 'MSM', 'GWI', 'SWH')
plot_order <- c('UP', 'SWAMP', 'TR', 'WC', 'SW')
plot_colors <- c("#20063B", "darkgrey", "#FFBC42", "#419973", "#25ABE6" )
#read in the raw metadata file
raw_metadata <- read.csv(Raw_Metadata)
