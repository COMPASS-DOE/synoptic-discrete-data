Site = "GCW",
Gas_Sample = "TGAS",
Zone = "UP",
Tree_Code = "SF") %>%
mutate(Replicate = str_extract(Sapflux_Tree_ID, "\\d+")) %>%
mutate(Tree_Info = case_when(
Tree_Code == "DS" ~ "Dead Standing",
Tree_Code == "SF" ~ "Sapflow Monitoring",
TRUE ~ "Other"  # Optional: handles any values that aren't DS or SF
)) %>%
mutate(Status = case_when(
Tree_Code == "DS" ~ "Dead Standing",
Tree_Code == "SF" ~ "Living",
TRUE ~ "Other"
)) %>%
mutate(CH4_Flag = case_when(
CH4_Flag == "Needs_Dilution" ~ "Over Std Curve Range",
TRUE ~ "Within Std Curve Range"
)) %>%
mutate(CO2_Flag = case_when(
CO2_Flag == "Needs_Dilution" ~ "Over Std Curve Range",
TRUE ~ "Within Std Curve Range"
))
#Put them in order and grab what we need
final_gcw_up <- gcw_up1 %>%
select( "Project", "Region" , "Year","Month" ,"Site", "Zone", "Gas_Sample",
"Sample_ID", "Tree_Code", "Replicate", "Status", "Tree_Info",
"CH4_ppm", "CH4_Flag", "CO2_ppm", "CO2_Flag")
#combine the TMP data with the rest of the data:
all_data_gcw <- rbind(all_data, final_gcw_up)
write.csv(all_data, "COMPASS_SynopticCB_TGAS_2023.csv")
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(openxlsx)
#read in 2022 TGAS Data:
dat22 <- read.csv("2022/COMPASS_SynopticCB_TGAS_2022.csv")
#read in 2023 TGAS Data:
dat23 <- read.csv("2023/COMPASS_SynopticCB_TGAS_2023.csv")
#read in the tree information about species and dbh
tree_dat <- read.csv("COMPASS_SynopticCB_TGAS_TreeInfo.csv")
head(tree_dat)
#combine the tree data with the 2022 File
tree_dat22 <- tree_dat %>%
select(!"DBH_2023_cm")
dat22_wtree <- left_join(dat22, tree_dat22, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat22_wtree <- dat22_wtree %>%
rename(DBH_cm = DBH_2022_cm)
#combine tree data with 2023 File
tree_dat23 <- tree_dat %>%
select(!"DBH_2022_cm")
dat23_wtree <- left_join(dat23, tree_dat23, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat23_wtree <- dat23_wtree %>%
rename(DBH_cm = DBH_2023_cm)
#combine all the data together in one dataframe
all_dat <- rbind(dat22_wtree, dat23_wtree)
all_dat <- all_dat %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "Replicate", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
#pull the column names from the all_dat dataframe and create a new dataframe with them
metadat <- data.frame(Column_Names = colnames(all_dat))
metadat$Description <- ""
metadat$Units <- ""
metadat$Instrument_ifapplicable <- ""
#add information about each line:
metadat$Description <- c("Project Name: Project Component",
"Region samples originated from: CB = Chesapeake Bay",
"Year (YYYY) of sample collection",
"Month of sample collection",
"Name of sampling transect location (GCW, SWH, MSM, GWI), see dataset locations for coordinates",
"Zone within space-for-time transect (UP=upland, TR=transition)",
"Replicate tree id (1-8)",
"USDA Species code for tree sampled",
"Diameter at breast height (DBH) for tree sampled in same year",
"Tree status indicates if the tree was Living or Dead Standing",
"Tree Info indicates if the tree had sapflow monitoring during sampling, dead trees were not monitored for sapflow",
"Sample identifier used in laboratory and field",
"Methane concentration of sample from tree gas well",
"Methane concentration flag: NA (data within instrument and std curve range) or Out of Std Curve Range.",
"Carbon Dioxide concentration of sample from tree gas well",
"Carbon Dioxide concentration flag: NA (data within instrument and std curve range) or Out of Std Curve Range." )
metadat$Units <-      c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"cm",
"NA",
"NA",
"NA",
"ppm",
"NA",
"ppm",
"NA" )
metadat$Instrument_ifapplicable <-  c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"DBH tape",
"NA",
"NA",
"NA",
"Varian 450 GC (Agilent Technologies)",
"NA",
"Varian 450 GC (Agilent Technologies)",
"NA" )
#write out a csv of all the data to the main folder:
write.csv(all_dat, "COMPASS_SynopticCB_TGAS_AllData.csv")
#write out an excel file for ESS DIVE with the data on the first sheet and metadata on the second
wb <- createWorkbook()
# Add worksheets and write data
addWorksheet(wb, "COMPASS_SynopticCB_TGAS_Data")
writeData(wb, sheet = "COMPASS_SynopticCB_TGAS_Data", all_dat)
addWorksheet(wb, "Metadata")
writeData(wb, sheet = "Metadata", metadat)
# Save the workbook
saveWorkbook(wb, "COMPASS_SynopticCB_TGAS_AllData_forESSDIVE.xlsx", overwrite = TRUE)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(openxlsx)
#read in 2022 TGAS Data:
dat22 <- read.csv("2022/COMPASS_SynopticCB_TGAS_2022.csv")
#read in 2023 TGAS Data:
dat23 <- read.csv("2023/COMPASS_SynopticCB_TGAS_2023.csv")
#read in the tree information about species and dbh
tree_dat <- read.csv("COMPASS_SynopticCB_TGAS_TreeInfo.csv")
head(tree_dat)
#combine the tree data with the 2022 File
tree_dat22 <- tree_dat %>%
select(!"DBH_2023_cm")
dat22_wtree <- left_join(dat22, tree_dat22, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat22_wtree <- dat22_wtree %>%
rename(DBH_cm = DBH_2022_cm)
#combine tree data with 2023 File
tree_dat23 <- tree_dat %>%
select(!"DBH_2022_cm")
dat23_wtree <- left_join(dat23, tree_dat23, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat23_wtree <- dat23_wtree %>%
rename(DBH_cm = DBH_2023_cm)
#combine all the data together in one dataframe
all_dat <- rbind(dat22_wtree, dat23_wtree)
all_dat <- all_dat %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "Replicate", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
#pull the column names from the all_dat dataframe and create a new dataframe with them
metadat <- data.frame(Column_Names = colnames(all_dat))
metadat$Description <- ""
metadat$Units <- ""
metadat$Instrument_ifapplicable <- ""
#add information about each line:
metadat$Description <- c("Project Name: Project Component",
"Region samples originated from: CB = Chesapeake Bay",
"Year (YYYY) of sample collection",
"Month of sample collection",
"Name of sampling transect location (GCW, SWH, MSM, GWI), see dataset locations for coordinates",
"Zone within space-for-time transect (UP=upland, TR=transition)",
"Replicate tree id (1-8)",
"USDA Species code for tree sampled",
"Diameter at breast height (DBH) for tree sampled in same year",
"Tree status indicates if the tree was Living or Dead Standing",
"Tree Info indicates if the tree had sapflow monitoring during sampling, dead trees were not monitored for sapflow",
"Sample identifier used in laboratory and field",
"Methane concentration of sample from tree gas well",
"Methane concentration flag: NA (data within instrument and std curve range) or Out of Std Curve Range.",
"Carbon Dioxide concentration of sample from tree gas well",
"Carbon Dioxide concentration flag: NA (data within instrument and std curve range) or Out of Std Curve Range." )
metadat$Units <-      c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"cm",
"NA",
"NA",
"NA",
"ppm",
"NA",
"ppm",
"NA" )
metadat$Instrument_ifapplicable <-  c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"DBH tape",
"NA",
"NA",
"NA",
"Varian 450 GC (Agilent Technologies)",
"NA",
"Varian 450 GC (Agilent Technologies)",
"NA" )
View(all_dat)
View(tree_dat)
#read in the tree information about species and dbh
tree_dat <- read.csv("COMPASS_SynopticCB_TGAS_TreeInfo.csv")
head(tree_dat)
#combine the tree data with the 2022 File
tree_dat22 <- tree_dat %>%
select(!"DBH_2023_cm")
dat22_wtree <- left_join(dat22, tree_dat22, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat22_wtree <- dat22_wtree %>%
rename(DBH_cm = DBH_2022_cm)
#combine tree data with 2023 File
tree_dat23 <- tree_dat %>%
select(!"DBH_2022_cm")
dat23_wtree <- left_join(dat23, tree_dat23, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat23_wtree <- dat23_wtree %>%
rename(DBH_cm = DBH_2023_cm)
#combine all the data together in one dataframe
all_dat <- rbind(dat22_wtree, dat23_wtree)
all_dat <- all_dat %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "Replicate", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
View(tree_dat22)
View(dat22_wtree)
View(all_dat)
View(dat23)
View(dat23)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
files <- list.files(path = "Processed Data", pattern = "\\.csv$", full.names = TRUE)
# 3. Read and combine all CSVs
all_data <- files %>%
lapply(read.csv) %>%    # or read.csv if you prefer base R
bind_rows()             # combine into one data frame
all_data <- all_data[ ,-1]
gcw_up <- read.csv("COMPASS_SynopticCB_GCW_UP_TGAS_2023.csv")
#pull out what we need
gcw_up1 <- gcw_up %>%
select( "Project", "Year","Month", "Sapflux_Tree_ID" ,
"Sample_ID","CH4_ppm", "CH4_Flag", "CO2_ppm", "CO2_Flag")
head(gcw_up1)
#clean it up and add necessary columns
gcw_up1 <- gcw_up1 %>%
mutate(Project = "COMPASS: Synoptic",
Region = "CB",
Site = "GCW",
Gas_Sample = "TGAS",
Zone = "UP",
Tree_Code = "SF") %>%
mutate(Replicate = str_extract(Sapflux_Tree_ID, "\\d+")) %>%
mutate(Tree_Info = case_when(
Tree_Code == "DS" ~ "Dead Standing",
Tree_Code == "SF" ~ "Sapflow Monitoring",
TRUE ~ "Other"  # Optional: handles any values that aren't DS or SF
)) %>%
mutate(Status = case_when(
Tree_Code == "DS" ~ "Dead Standing",
Tree_Code == "SF" ~ "Living",
TRUE ~ "Other"
)) %>%
mutate(CH4_Flag = case_when(
CH4_Flag == "Needs_Dilution" ~ "Over Std Curve Range",
TRUE ~ "Within Std Curve Range"
)) %>%
mutate(CO2_Flag = case_when(
CO2_Flag == "Needs_Dilution" ~ "Over Std Curve Range",
TRUE ~ "Within Std Curve Range"
))
#Put them in order and grab what we need
final_gcw_up <- gcw_up1 %>%
select( "Project", "Region" , "Year","Month" ,"Site", "Zone", "Gas_Sample",
"Sample_ID", "Tree_Code", "Replicate", "Status", "Tree_Info",
"CH4_ppm", "CH4_Flag", "CO2_ppm", "CO2_Flag")
#combine the TMP data with the rest of the data:
all_data_gcw <- rbind(all_data, final_gcw_up)
View(final_gcw_up)
write.csv(all_data_gcw, "COMPASS_SynopticCB_TGAS_2023.csv")
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(openxlsx)
#read in 2022 TGAS Data:
dat22 <- read.csv("2022/COMPASS_SynopticCB_TGAS_2022.csv")
#read in 2023 TGAS Data:
dat23 <- read.csv("2023/COMPASS_SynopticCB_TGAS_2023.csv")
#read in the tree information about species and dbh
tree_dat <- read.csv("COMPASS_SynopticCB_TGAS_TreeInfo.csv")
head(tree_dat)
#combine the tree data with the 2022 File
tree_dat22 <- tree_dat %>%
select(!"DBH_2023_cm")
dat22_wtree <- left_join(dat22, tree_dat22, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat22_wtree <- dat22_wtree %>%
rename(DBH_cm = DBH_2022_cm)
#combine tree data with 2023 File
tree_dat23 <- tree_dat %>%
select(!"DBH_2022_cm")
dat23_wtree <- left_join(dat23, tree_dat23, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat23_wtree <- dat23_wtree %>%
rename(DBH_cm = DBH_2023_cm)
#combine all the data together in one dataframe
all_dat <- rbind(dat22_wtree, dat23_wtree)
all_dat <- all_dat %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "Replicate", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
View(all_dat)
dat22 <- dat22 %>%
mutate(replicate = case_when(
site == "GCW" & zone == "UP" & replicate == 1 ~ 7,
site == "GCW" & zone == "UP" & replicate == 2 ~ 11,
site == "GCW" & zone == "UP" & replicate == 4 ~ 19,
TRUE ~ replicate  # keep existing value otherwise
))
dat22 <- dat22 %>%
mutate(replicate = case_when(
Site == "GCW" & Zone == "UP" & Replicate == 1 ~ 7,
Site == "GCW" & Zone == "UP" & Replicate == 2 ~ 11,
Site == "GCW" & Zone == "UP" & Replicate == 4 ~ 19,
TRUE ~ replicate  # keep existing value otherwise
))
dat22 <- dat22 %>%
mutate(replicate = case_when(
Site == "GCW" & Zone == "UP" & Replicate == 1 ~ 7,
Site == "GCW" & Zone == "UP" & Replicate == 2 ~ 11,
Site == "GCW" & Zone == "UP" & Replicate == 4 ~ 19,
TRUE ~ replicate  # keep existing value otherwise
))
dat22 <- dat22 %>%
mutate(Replicate = case_when(
Site == "GCW" & Zone == "UP" & Replicate == 1 ~ 7,
Site == "GCW" & Zone == "UP" & Replicate == 2 ~ 11,
Site == "GCW" & Zone == "UP" & Replicate == 4 ~ 19,
TRUE ~ replicate  # keep existing value otherwise
))
View(dat22)
dat22$Replicate <- as.numeric(dat22$Replicate)
dat22 <- dat22 %>%
mutate(Replicate = case_when(
Site == "GCW" & Zone == "UP" & Replicate == 1 ~ 7,
Site == "GCW" & Zone == "UP" & Replicate == 2 ~ 11,
Site == "GCW" & Zone == "UP" & Replicate == 4 ~ 19,
TRUE ~ replicate  # keep existing value otherwise
))
dat22 <- dat22 %>%
mutate(Replicate = case_when(
Site == "GCW" & Zone == "UP" & Replicate == 1 ~ 7,
Site == "GCW" & Zone == "UP" & Replicate == 2 ~ 11,
Site == "GCW" & Zone == "UP" & Replicate == 4 ~ 19,
TRUE ~ Replicate  # keep existing value otherwise
))
all_dat <- all_dat %>%
rename(Replicate = SF_Replicate_ID) %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "Replicate", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
all_dat <- all_dat %>%
rename(Replicate = SF_Replicate_ID) %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "SF_Replicate_ID", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
all_dat <- all_dat %>%
rename( SF_Replicate_ID = Replicate ) %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "SF_Replicate_ID", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(openxlsx)
#read in 2022 TGAS Data:
dat22 <- read.csv("2022/COMPASS_SynopticCB_TGAS_2022.csv")
#need to deal with some of the tempest data that has the wrong replicate info
#a rep of 1 = C7
#a rep of 2 = C11
#a rep of 4 = C19
dat22$Replicate <- as.numeric(dat22$Replicate)
dat22 <- dat22 %>%
mutate(Replicate = case_when(
Site == "GCW" & Zone == "UP" & Replicate == 1 ~ 7,
Site == "GCW" & Zone == "UP" & Replicate == 2 ~ 11,
Site == "GCW" & Zone == "UP" & Replicate == 4 ~ 19,
TRUE ~ Replicate  # keep existing value otherwise
))
#read in 2023 TGAS Data:
dat23 <- read.csv("2023/COMPASS_SynopticCB_TGAS_2023.csv")
#read in the tree information about species and dbh
tree_dat <- read.csv("COMPASS_SynopticCB_TGAS_TreeInfo.csv")
head(tree_dat)
#combine the tree data with the 2022 File
tree_dat22 <- tree_dat %>%
select(!"DBH_2023_cm")
dat22_wtree <- left_join(dat22, tree_dat22, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat22_wtree <- dat22_wtree %>%
rename(DBH_cm = DBH_2022_cm)
#combine tree data with 2023 File
tree_dat23 <- tree_dat %>%
select(!"DBH_2022_cm")
dat23_wtree <- left_join(dat23, tree_dat23, by = c("Site", "Zone", "Tree_Code", "Replicate"))
dat23_wtree <- dat23_wtree %>%
rename(DBH_cm = DBH_2023_cm)
#combine all the data together in one dataframe
all_dat <- rbind(dat22_wtree, dat23_wtree)
all_dat <- all_dat %>%
rename( SF_Replicate_ID = Replicate ) %>%
mutate(CH4_Flag = recode(CH4_Flag, "Within Std Curve Range" = "NA")) %>%
mutate(CO2_Flag = recode(CO2_Flag, "Within Std Curve Range" = "NA")) %>%
select("Project", "Region", "Year", "Month", "Site", "Zone", "SF_Replicate_ID", "Species" ,
"DBH_cm" ,  "Status",  "Tree_Info", "Sample_ID","CH4_ppm", "CH4_Flag",  "CO2_ppm","CO2_Flag")
#pull the column names from the all_dat dataframe and create a new dataframe with them
metadat <- data.frame(Column_Names = colnames(all_dat))
metadat$Description <- ""
metadat$Units <- ""
metadat$Instrument_ifapplicable <- ""
#add information about each line:
metadat$Description <- c("Project Name: Project Component",
"Region samples originated from: CB = Chesapeake Bay",
"Year (YYYY) of sample collection",
"Month of sample collection",
"Name of sampling transect location (GCW, SWH, MSM, GWI), see dataset locations for coordinates",
"Zone within space-for-time transect (UP=upland, TR=transition)",
"Sap Flow (SF) Replicate tree id (1-8, 11, 19). The ID for the sapflow sensor associated with the tree (only live trees)",
"USDA Species code for tree sampled",
"Diameter at breast height (DBH) for tree sampled in same year",
"Tree status indicates if the tree was Living or Dead Standing",
"Tree Info indicates if the tree had sapflow monitoring during sampling, dead trees were not monitored for sapflow",
"Sample identifier used in laboratory and field",
"Methane concentration of sample from tree gas well",
"Methane concentration flag: NA (data within instrument and std curve range) or Out of Std Curve Range.",
"Carbon Dioxide concentration of sample from tree gas well",
"Carbon Dioxide concentration flag: NA (data within instrument and std curve range) or Out of Std Curve Range." )
metadat$Units <-      c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"cm",
"NA",
"NA",
"NA",
"ppm",
"NA",
"ppm",
"NA" )
metadat$Instrument_ifapplicable <-  c("NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"NA",
"DBH tape",
"NA",
"NA",
"NA",
"Varian 450 GC (Agilent Technologies)",
"NA",
"Varian 450 GC (Agilent Technologies)",
"NA" )
#write out a csv of all the data to the main folder:
write.csv(all_dat, "COMPASS_SynopticCB_TGAS_AllData.csv")
#write out an excel file for ESS DIVE with the data on the first sheet and metadata on the second
wb <- createWorkbook()
# Add worksheets and write data
addWorksheet(wb, "COMPASS_SynopticCB_TGAS_Data")
writeData(wb, sheet = "COMPASS_SynopticCB_TGAS_Data", all_dat)
addWorksheet(wb, "Metadata")
writeData(wb, sheet = "Metadata", metadat)
# Save the workbook
saveWorkbook(wb, "COMPASS_SynopticCB_TGAS_AllData_forESSDIVE.xlsx", overwrite = TRUE)
install.packages("formatR")
