---
title: "COMPASS_SynopticCB_Collate_TGAS_2022_Data"
author: "Stephanie J. Wilson"
date: "2025-08-29"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readxl)
library(tidyr)
library(tibble)
library(lubridate)
```

#Read in and collate all the files in the Processed Data folder 
```{r}
##Read in list of processed data files
files <- list.files(path = "Processed Data", pattern = "\\.csv$", full.names = TRUE)

desired_columns <- c("Project",	"Region",	"Site",	"Zone",	"Replicate",	"Depth_cm",	"Sample_ID",	"Year",	"Month",	"Day",	"Time",	"Time_Zone",	"SO4_Conc_mM",	"SO4_Conc_flag",	"SO4_QAQC_flag",	"Cl_Conc_mM",	"Cl_Conc_flag",	"Cl_QAQC_flag",	"salinity",	"Analysis_rundate",	"Run_notes",	"Field_notes")
```

##File 1
```{r}
##Read in each data file
file1 <- read.csv(files[1])
head(file1)

missing_columns <- setdiff(desired_columns, names(file1))
for (col in missing_columns) {
  file1[[col]] <- NA
}

file1_clean <- file1 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Date = Site,
    Site = Zone,
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

file1_clean <- file1_clean %>%
  mutate(Date = ymd(Date)) %>%
  mutate(Year = year(Date),
         Month = month(Date), 
         Day = day(Date) )

missing_columns <- setdiff(desired_columns, names(file1_clean))
for (col in missing_columns) {
  file1_clean[[col]] <- NA
}

head(file1_clean)

file1_cols <- file1_clean[, desired_columns]
head(file1_cols)
```

##File 2
```{r}
file2 <- read.csv(files[2])
head(file2)

missing_columns <- setdiff(desired_columns, names(file2))
for (col in missing_columns) {
  file2[[col]] <- NA
}

head(file2)

file2_clean <- file2 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

file2_clean <- file2_clean %>%
  mutate(Date = ym(Date)) %>%
  mutate(Year = year(Date),
         Month = month(Date))

##Don't know when these samples were taken but this says June 1st for now 
# The date column isn't in the final dataset so this should be okay 

missing_columns <- setdiff(desired_columns, names(file2_clean))
for (col in missing_columns) {
  file2_clean[[col]] <- NA
}

head(file2_clean)

file2_cols <- file2_clean[, desired_columns]
head(file2_cols)
```

##File 3
```{r}
file3 <- read.csv(files[3])
head(file3)

missing_columns <- setdiff(desired_columns, names(file3))
for (col in missing_columns) {
  file3[[col]] <- NA
}

head(file3)

file3_clean <- file3 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

file3_date <- file3_clean %>%
  mutate(Date = ym(Date)) %>%
  mutate(Year = year(Date),
         Month = month(Date) )


missing_columns <- setdiff(desired_columns, names(file3_date))
for (col in missing_columns) {
  file3_date[[col]] <- NA
}

head(file3_date)

file3_cols <- file3_date[, desired_columns]
head(file3_cols)
```

##File 4
```{r}
file4 <- read.csv(files[4])
head(file4)

missing_columns <- setdiff(desired_columns, names(file4))
for (col in missing_columns) {
  file4[[col]] <- NA
}

head(file4)

file4_clean <- file4 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Date_long = Site, 
    Site = Date, 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

file4_date <- file4_clean %>%
  mutate(Date = ym(Date_long)) %>%
  mutate(Year = year(Date),
         Month = month(Date) )


missing_columns <- setdiff(desired_columns, names(file4_date))
for (col in missing_columns) {
  file4_date[[col]] <- NA
}

head(file4_date)

file4_cols <- file4_date[, desired_columns]
head(file4_cols)
```

##File 5
```{r}
file5 <- read.csv(files[5])
head(file5)

missing_columns <- setdiff(desired_columns, names(file5))
for (col in missing_columns) {
  file5[[col]] <- NA
}

head(file5)

file5_clean <- file5 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Date_long = Site, 
    Site = Date, 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

file5_date <- file5_clean %>%
  mutate(Date = ym(Date_long)) %>%
  mutate(Year = year(Date),
         Month = month(Date) )


missing_columns <- setdiff(desired_columns, names(file5_date))
for (col in missing_columns) {
  file5_date[[col]] <- NA
}

head(file5_date)

file5_cols <- file5_date[, desired_columns]
head(file5_cols)
```

##File 6
```{r}
file6 <- read.csv(files[6])
head(file6)

missing_columns <- setdiff(desired_columns, names(file6))
for (col in missing_columns) {
  file6[[col]] <- NA
}

head(file6)

file6_clean <- file6 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

head(file6_clean)

file6_date <- file6_clean %>%
  mutate(Date = ym(Date)) %>%
  mutate(Year = year(Date),
         Month = month(Date) )


missing_columns <- setdiff(desired_columns, names(file6_date))
for (col in missing_columns) {
  file6_date[[col]] <- NA
}

head(file6_date)

file6_cols <- file6_date[, desired_columns]
head(file6_cols)
```

##File 7
```{r}
file7 <- read.csv(files[7])
head(file7)

missing_columns <- setdiff(desired_columns, names(file7))
for (col in missing_columns) {
  file7[[col]] <- NA
}

head(file7)

file7_clean <- file7 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

head(file7_clean)

file7_date <- file7_clean %>%
  mutate(Date = ym(Date)) %>%
  mutate(Year = year(Date),
         Month = month(Date) )


missing_columns <- setdiff(desired_columns, names(file7_date))
for (col in missing_columns) {
  file7_date[[col]] <- NA
}

head(file7_date)

file7_cols <- file7_date[, desired_columns]
head(file7_cols)
```

##File 8
```{r}
file8 <- read.csv(files[8])
head(file8)

missing_columns <- setdiff(desired_columns, names(file8))
for (col in missing_columns) {
  file8[[col]] <- NA
}

head(file8)

file8_clean <- file8 %>%
  mutate(
    Project = "COMPASS: Synoptic", 
    Region = "CB", 
    Depth_cm = Depth, 
    SO4_Conc_mM = SO4_mM,
    Cl_Conc_mM = Cl_mM)

head(file8_clean)

file8_date <- file8_clean %>%
  mutate(Date = ym(Date)) %>%
  mutate(Year = year(Date),
         Month = month(Date) )


missing_columns <- setdiff(desired_columns, names(file8_date))
for (col in missing_columns) {
  file8_date[[col]] <- NA
}

head(file8_date)

file8_cols <- file8_date[, desired_columns]
head(file8_cols)
```

##Combine all data files
```{r}
##Need to format data files to look like the 2024 processed data with these column names: 
# "Project"	"Region"	"Site"	"Zone"	"Replicate"	"Depth_cm"	"Sample_ID"	"Year"	"Month"	"Day"	"Time"	"Time_Zone"	"SO4_Conc_mM"	"SO4_Conc_flag"	"SO4_QAQC_flag"	"Cl_Conc_mM"	"Cl_Conc_flag"	"Cl_QAQC_flag"	"salinity"	"Analysis_rundate"	"Run_notes"	"Field_notes"

all_data <- bind_rows(file1_cols, file2_cols, file3_cols, file4_cols, file5_cols, file6_cols, file7_cols, file8_cols)

all_data <- all_data %>%
  mutate(Site = recode(Site, "GCrew" = "GCW")) %>%
   mutate(Sample_ID = str_replace(Sample_ID, "GCrew", "GCW"))

all_data <- subset(all_data, Sample_ID != "Blank")

```

## Write the 2022 file out to the folder 
```{r, echo=FALSE}

write.csv(all_data, "COMPASS_SynopticCB_SO4_Cl_2022.csv")

```

##END