---
title: "Synoptic_CB_Nutrients_2023_AnalysisTemplate"
author: "Stephanie J. Wilson"
date: "2025-05-05"
output: html_document
---

---
title: "COMPASS Synoptic Discrete Data Workflow: Example Worflow"
author: "Stephanie J. Wilson & Stephanie Pennington"
date: '2024-10-08'
output: html_document
---
##Setup
```{r setup, include=FALSE}

#let you know which section you are in 
cat("Setup")

#a link to the Gitbook or whatever protocol you are using for this analysis 


#Maybe using pacman instead?
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  dplyr,
  ggplot2,
  ggpubr,
  stringr,
  readr)

#Packages that are required 
  library(dplyr)
  library(ggplot2)
  library(ggpubr)
  library(stringr)
  library(readr)
  library(stringr)

#Coefficients / constants that are needed for calculations 
N_mw <- 14.0067    # molecular weight of N 
P_mw <- 30.973762  # molecular weight of P 
Con1 <- 1000       # conversion factor value
Con2 <- 1000000    # conversion factor value 


#expected ranges for sample concentrations used for flags 
  # min_conc = int
  # max_conc = int
  # cv_flag = 10% 
  # rep_flag = 10%

#check standard concentrations 
  # chk_std = 10
  

#any reference to other code 



```

## Import Data  
```{r Import Data, echo=FALSE}
cat("Import Data")

#setwd("/Raw Data")

#set working directory
  #could be from google drive or local drive etc. 
path <- ("file path")

#---------------------

#---------------------NOX---------------------
#Read in Raw Data 
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
  #Renaming Columns 
  rename(`NOx_Conc_mgNL⁻¹` = `...6`,
         `Absorbance` = `...7`,
         `Dilution` = `...9`,
         `Sample_Name` = `...4`,
         `Test` = `...13`,
         `Run_Time` = `...15`) 


#making list to remove other columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...12", "...14")

#Removing other columns
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
  select(-all_of(cols_to_remove)) %>%
  select(!c(1,2))

#Checking column headers
head(NOx_COMP_Syn)

#Combine NOx Runs

#---------------------PO4----------------------

#---------------------___----------------------


```

## Assessing standard Curves 
```{r Assess Standard Curves, echo=FALSE}
cat("Assess Standard Curves")

#Pulling standards within raw file 
stds_NOx <- c(0.0222, 0.05, 0.1, 0.25, 0.5, 0.75, 1)



 Stds_NOx_COMP_Syn <- NOx_COMP_Syn %>%
  filter(str_detect(Sample_Name, "Standard")) %>%
  mutate(`NOx_Conc_mgNL⁻¹` = case_when(
    Sample_Name == "Standard_11" ~ 0.0222,
    Sample_Name == "Standard_12" ~ 0.05,
    Sample_Name == "Standard_13" ~ 0.1,
    Sample_Name == "Standard_14" ~ 0.25,
    Sample_Name == "Standard_15" ~ 0.5,
    Sample_Name == "Standard_16" ~ 0.75,
    Sample_Name == "Standard_17" ~ 1.0,
    TRUE ~ `NOx_Conc_mgNL⁻¹`  # leave unchanged if no match
  ))
    head(Stds_NOx_COMP_Syn)


# Filter standard samples and replace concentration values
Stds_NOx_COMP_Syn <- NOx_COMP_Syn %>%
  filter(str_detect(Sample_Name, "Standard")) %>%
  mutate(`NOx_Conc_mgNL⁻¹` = stds_NOx)
  
#Plot standard Curve or Curves 
Std_Curve_NOx <- ggplot(data = Stds_NOx_COMP_Syn, aes())
  


#Pull out slope and R2 


#Report out a flag if the run has an R2 lower than appropriate 


#compare slopes to previous runs (from log) in order to assess drift 


#write out slopes from current run to log 

```

## Sample Processing - Calculating Concentrations  
```{r Sample Processing, echo=FALSE}

cat("Sample Processing")

#Remove standards or other checks not needed here if necessary 


#Calculate concentrations from standard curve 


```

## Sample Flagging - Within standards range?  
```{r Sample Processing, echo=FALSE}

cat("Sample Flagging")

#Flagging data if the concentration is outside the standards range 


#Flagging for CV of analytical duplicates or replicates 



```

## Analyze the Check Standards 
```{r Check Standards, echo=FALSE}

cat("Analysis Check Standards")

#Pull out check standards from raw file 


#Calculate their concentrations if not done already 


#change this if check standard concentrations are different 


#calculate percent difference between check standards & expected concentration 


#flag if the percent difference is over X% (defined in setup)


#Visualize check std concentrations vs. the expected concentrations


#report out if flags indicate need for rerun


```

## Dilution Corrections 
```{r Dilution Corrections}

cat("Dilution Corrections")

#Calculate the concentration when accounting for the dilution factor if applicable



```

## Visualize Data 
```{r Visualize Data}

cat("Visualize Data")

#Plot samples to get a first look at concentrations (sanity check)


```

## Export Processed Data  
```{r, Export Processed Data}

cat("Export Processed Data")

#set working directory 
finalpath <- "file path"

#Prepare data to be exported 

#Add any necessary identifiers to the samples  ### VERY IMPORTANT AND STANDARD FOR PROJECT ####
  #example read in sample IDs list and merge 
  #create required ID columns in R, etc. 

#Write out data frame 
write.csv(alldat, "file_name")

```

#end