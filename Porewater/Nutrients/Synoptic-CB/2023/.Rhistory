library(stringr)
#Coefficients / constants that are needed for calculations
N_mw <- 14.0067    # molecular weight of N
P_mw <- 30.973762  # molecular weight of P
Con1 <- 1000       # conversion factor value
Con2 <- 1000000    # conversion factor value
#expected ranges for sample concentrations used for flags
# min_conc = int
# max_conc = int
# cv_flag = 10%
# rep_flag = 10%
#check standard concentrations
# chk_std = 10
#any reference to other code
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns (check data file for TYPE and CUP)
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Samp_Name` = `...4`,
`Analysis` = `...13`,
`Run_Time` = `...15`)
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns (check data file for TYPE and CUP)
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Samp_Name` = `...4`,
`Analysis` = `...13`,
`Run_Time` = `...15`)
View(NOx_COMP_Syn_Rename)
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Samp_Name` = `...4`,
`Test` = `...13`,
`Run_Time` = `...15`)
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Samp_Name` = `...4`,
`Test` = `...13`,
`Run_Time` = `...15`)
#making list to remove other columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...12", "...14")
#Removing other columns
NOx_COMP_Syn <- COMP_Syn_NOx_4_23_Rename %>%
select(-all_of(cols_to_remove))
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Samp_Name` = `...4`,
`Test` = `...13`,
`Run_Time` = `...15`)
#making list to remove other columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...12", "...14")
#Removing other columns
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
select(-all_of(cols_to_remove))
#Checking column headers
head(NOx_COMP_Syn)
View(NOx_COMP_Syn)
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Sample_Name` = `...4`,
`Test` = `...13`,
`Run_Time` = `...15`)
#making list to remove other columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...12", "...14")
#Removing other columns
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
select(-all_of(cols_to_remove))
#Checking column headers
head(NOx_COMP_Syn)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn[NOx_COMP_Syn$Sample_Name %like% "Standard", ]
head(Stds_NOx_COMP_Syn)
View(Stds_NOx_COMP_Syn)
View(Stds_NOx_COMP_Syn)
View(Stds_NOx_COMP_Syn)
View(NOx_COMP_Syn_Rename)
View(NOx_COMP_Syn)
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
select(-all_of(cols_to_remove), c(1, 2))
head(NOx_COMP_Syn)
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Sample_Name` = `...4`,
`Test` = `...13`,
`Run_Time` = `...15`)
#making list to remove other columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...12", "...14")
#Removing other columns
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
select(-all_of(cols_to_remove), c(1, 2))
#Checking column headers
head(NOx_COMP_Syn)
View(NOx_COMP_Syn)
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))
head(NOx_COMP_Syn)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn[NOx_COMP_Syn$Sample_Name %like% "Standard", ]
head(Stds_NOx_COMP_Syn)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn[NOx_COMP_Syn$Sample_Name %like% "Standard", ]
head(Stds_NOx_COMP_Syn)
stds_NOx <- c(0.0222, 0.05, 0.1, 0.25, 0.5, 0.75, 1)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn[NOx_COMP_Syn$Sample_Name %like% "Standard", ]%>%
mutate(`NOx_Conc_mgNL⁻¹` = recode(`NOx_Conc_mgNL⁻¹`, !!!stds_NOx))
head(Stds_NOx_COMP_Syn)
stds_NOx <- c("0.0222" = 0.02, "0.05" = 0.05, "0.1" = 0.1, "0.25" = 0.25,
"0.5" = 0.5, "0.75" = 0.75, "1" = 1)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn[NOx_COMP_Syn$Sample_Name %like% "Standard", ]%>%
mutate(`NOx_Conc_mgNL⁻¹` = recode(`NOx_Conc_mgNL⁻¹`, !!!stds_NOx))
head(Stds_NOx_COMP_Syn)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn %>%
filter(str_detect(Sample_Name, "Standard")) %>%
mutate(`NOx_Conc_mgNL⁻¹` = case_when(
Sample_Name == "Standard_11" ~ 0.0222,
Sample_Name == "Standard_12" ~ 0.05,
Sample_Name == "Standard_13" ~ 0.1,
Sample_Name == "Standard_14" ~ 0.25,
Sample_Name == "Standard_15" ~ 0.5,
Sample_Name == "Standard_16" ~ 0.75,
Sample_Name == "Standard_17" ~ 1.0,
TRUE ~ `NOx_Conc_mgNL⁻¹`  # leave unchanged if no match
))
head(Stds_NOx_COMP_Syn)
Stds_NOx_COMP_Syn
unique(NOx_COMP_Syn$Sample_Name)
View(Stds_NOx_COMP_Syn)
stds_NOx <- c(0.0222, 0.05, 0.1, 0.25, 0.5, 0.75, 1)
# Filter standard samples and replace concentration values
Stds_NOx_COMP_Syn <- NOx_COMP_Syn %>%
filter(str_detect(Sample_Name, "Standard")) %>%
mutate(`NOx_Conc_mgNL⁻¹` = stds_NOx)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn %>%
filter(str_detect(Sample_Name, "Standard")) %>%
mutate(`NOx_Conc_mgNL⁻¹` = `stds_NOx_mgNL⁻¹`)
Stds_NOx_COMP_Syn <- NOx_COMP_Syn %>%
filter(str_detect(Sample_Name, "Standard")) %>%
mutate(`NOx_Conc_mgNL⁻¹` = stds_NOx)
#let you know which section you are in
cat("Setup")
#a link to the Gitbook or whatever protocol you are using for this analysis
#Maybe using pacman instead?
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
dplyr,
ggplot2,
ggpubr,
stringr,
readr)
#Packages that are required
library(dplyr)
library(ggplot2)
library(ggpubr)
library(stringr)
library(readr)
library(stringr)
#Coefficients / constants that are needed for calculations
N_mw <- 14.0067    # molecular weight of N
P_mw <- 30.973762  # molecular weight of P
Con1 <- 1000       # conversion factor value
Con2 <- 1000000    # conversion factor value
#expected ranges for sample concentrations used for flags
# min_conc = int
# max_conc = int
# cv_flag = 10%
# rep_flag = 10%
#check standard concentrations
# chk_std = 10
#any reference to other code
cat("Import Data")
#setwd("/Raw Data")
#set working directory
#could be from google drive or local drive etc.
path <- ("file path")
#---------------------
#---------------------NOX---------------------
#Read in Raw Data
NOx_COMP_Syn_Rename <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv") %>%
#Renaming Columns
rename(`NOx_Conc_mgNL⁻¹` = `...6`,
`Absorbance` = `...7`,
`Dilution` = `...9`,
`Sample_Name` = `...4`,
`Test` = `...13`,
`Run_Time` = `...15`)
#making list to remove other columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...12", "...14")
#Removing other columns
NOx_COMP_Syn <- NOx_COMP_Syn_Rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))
#Checking column headers
head(NOx_COMP_Syn)
#Combine NOx Runs
#---------------------PO4----------------------
#---------------------___----------------------
# Rename columns
NOx_COMP_Syn_Rename <- combined_data %>%
rename(NOx_Conc_mgNL⁻¹ = ...6,
NOx_COMP_Syn_Rename <- combined_data %>%
rename('NOx_Conc_mgNL⁻¹' = ...6,
'Absorbance' = ...7,
'Dilution' = ...9,
'Sample_Name' = ...4,
'Test' = ...13,
'Run_Time' = ...15)
View(NOx_COMP_Syn_Rename)
View(NOx_COMP_Syn)
dat_NH3_PO4 <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NH3_PO4_April2023_1.csv")
View(dat_NH3_PO4)
dat_NOx <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv")
View(dat_NOx)
dat_NOx <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NOx_April2023_1.csv")
dat_NH3_PO4 <- readr::read_csv("Raw Data/SEAL_COMPASS_Synoptic_NH3_PO4_April2023_1.csv")
# Combining Files
df_combo <- bind_rows(dat_NOx, dat_NH3_PO4)
df_all_rename <- df_combo %>%
rename('Conc' = ...6,
'Absorbance' = ...7,
'Dilution' = ...9,
'Sample_Name' = ...4,
'Test' = ...13,
'Run_Time' = ...15)
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...14")
df_all <- df_all_rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))
View(df_all)
df_all_rename <- df_combo %>%
rename('Conc' = ...6,
'Absorbance' = ...7,
'Dilution' = ...9,
'Sample_Name' = ...4,
'Test' = ...13,
'Run_Time' = ...15,
'Unit' = ...12)
df_all <- df_all_rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))
df_all <- df_all_rename %>%
select(-all_of(cols_to_remove))
df_all <- df_all_rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))%>%
select(!c(10,11))
df_all <- df_all_rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))%>%
select(!c(8,9))
stds_NOx <- c(0.0222, 0.05, 0.1, 0.25, 0.5, 0.75, 1)
# Rename columns
df_combo_rename <- df_combo %>%
rename('Conc' = ...6,
'Absorbance' = ...7,
'Dilution' = ...9,
'Sample_Name' = ...4,
'Test' = ...13,
'Run_Time' = ...15,
'Unit' = ...12)
#making list to remove columns
cols_to_remove <- c("RUNSTARTED", "...5", "...8", "...10", "...11", "...14")
#Removing columns
df_all <- df_combo_rename %>%
select(-all_of(cols_to_remove)) %>%
select(!c(1,2))%>%
select(!c(8,9))
#Checking column headers
head(NOx_COMP_Syn)
#Checking column headers
head(df_all)
stds <- df_all[df_all$Sample_Name %like% "Standard", ]
head(stds)
stds <- df_all[df_all$Sample_Name %like% "Standard", ]
stds_NOx<- stds[stds$Test == "Vanadium NOx"]
stds <- df_all[df_all$Sample_Name %like% "Standard", ]
stds_NOx<- stds[stds$Test == "Vanadium NOx", ]
stds <- df_all[df_all$Sample_Name %like% "Standard", ]
stds_NOx <- stds[stds$Test == "Vanadium NOx", ]
stds_NH3 <- stds[stds$Test == "Ammonia 2", ]
stds_PO4 <- stds[stds$Test == "o-PHOS 0.3", ]
View(stds_NH3)
stds_NOx <- stds_NOx %>%
mutate(`NOx_Conc_mgNL⁻¹` = case_when(
Sample_Name == "Standard_1" ~ 1.0,
Sample_Name == "Standard_90" ~ 0.0222,
Sample_Name == "Standard_91" ~ 0.05,
Sample_Name == "Standard_92" ~ 0.1,
Sample_Name == "Standard_93" ~ 0.25,
Sample_Name == "Standard_94" ~ 0.5,
Sample_Name == "Standard_95" ~ 0.75,
Sample_Name == "Standard_96" ~ 1.0,
TRUE ~ `NOx_Conc_mgNL⁻¹`  # leave unchanged if no match
))
stds_NOx <- stds_NOx %>%
mutate(`Conc` = case_when(
Sample_Name == "Standard_1" ~ 1.0,
Sample_Name == "Standard_90" ~ 0.0222,
Sample_Name == "Standard_91" ~ 0.05,
Sample_Name == "Standard_92" ~ 0.1,
Sample_Name == "Standard_93" ~ 0.25,
Sample_Name == "Standard_94" ~ 0.5,
Sample_Name == "Standard_95" ~ 0.75,
Sample_Name == "Standard_96" ~ 1.0,
TRUE ~ `Conc⁻¹`  # leave unchanged if no match
))
stds_NOx <- stds_NOx %>%
mutate(`Conc` = case_when(
Sample_Name == "Standard_1" ~ 1.0,
Sample_Name == "Standard_90" ~ 0.0222,
Sample_Name == "Standard_91" ~ 0.05,
Sample_Name == "Standard_92" ~ 0.1,
Sample_Name == "Standard_93" ~ 0.25,
Sample_Name == "Standard_94" ~ 0.5,
Sample_Name == "Standard_95" ~ 0.75,
Sample_Name == "Standard_96" ~ 1.0,
TRUE ~ `Conc`  # leave unchanged if no match
))
View(dat_NOx)
View(stds_NOx)
stds_NH3 <- stds_NH3 %>%
mutate(`Conc` = case_when(
#    Sample_Name == "Standard_1" ~ 1.0, -> CHECK TO SEE WHAT IS
Sample_Name == "Standard_90" ~ 0.0389,
Sample_Name == "Standard_91" ~ 0.1,
Sample_Name == "Standard_92" ~ 0.2,
Sample_Name == "Standard_93" ~ 0.5,
Sample_Name == "Standard_94" ~ 1.0,
Sample_Name == "Standard_95" ~ 1.5,
Sample_Name == "Standard_96" ~ 2,
TRUE ~ `Conc`  # leave unchanged if no match
))
stds_PO4 <- stds_PO4 %>%
mutate(`Conc` = case_when(
#    Sample_Name == "Standard_1" ~ 1.0, -> CHECK TO SEE WHAT IS
Sample_Name == "Standard_90" ~ 0.0060,
Sample_Name == "Standard_91" ~ 0.0150,
Sample_Name == "Standard_92" ~ 0.0300,
Sample_Name == "Standard_93" ~ 0.0750,
Sample_Name == "Standard_94" ~ 0.1500,
Sample_Name == "Standard_95" ~ 0.2250,
Sample_Name == "Standard_96" ~ 0.3000,
TRUE ~ `Conc`  # leave unchanged if no match
))
Std_Curve_NOx <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line()+
geom_point(aes(size=3)) +
theme_classic() +
ylim(-0.5,0.5) +
theme(legend.position="none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = Test)
stds_combo <- bind_rows(stds_NOx, stds_NH3, stds_PO4)
Std_Curve_NOx <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line()+
geom_point(aes(size=3)) +
theme_classic() +
ylim(-0.5,0.5) +
theme(legend.position="none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = Test)
Std_Curves <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line()+
geom_point(aes(size=3)) +
theme_classic() +
ylim(-0.5,0.5) +
theme(legend.position="none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = Std_Curves$Test)
Std_Curves <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line() +
geom_point(size = 3) +
theme_classic() +
theme(legend.position = "none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = vars(Test))
Std_Curves
Std_Curves <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line() +
geom_point(size = 3) +
theme_basic() +
theme(legend.position = "none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = vars(Test))
Std_Curves <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line() +
geom_point(size = 3) +
theme_basic() +
theme(legend.position = "none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = vars(Test))
Std_Curves <- ggplot(data = stds_combo, aes(x = Conc, y = Absorbance)) +
geom_line() +
geom_point(size = 3) +
theme_bw() +
theme(legend.position = "none") +
ggtitle("PO4 Intercepts") +
facet_grid(rows = vars(Test))
Std_Curves
Std_Curves
stds_test <- stds %>%
group_by(Test) %>%
nest() %>%
mutate(
model = map(data, ~ lm(Absorbance ~ Conc, data = .x)),
tidied = map(model, broom::tidy),
glanced = map(model, broom::glance),
Run_Time = map_chr(data, ~ as.character(.x$Run_Time[1]))
)
stds_test
stds_test
View(stds_test)
stds_test <- stds_combo %>%
group_by(Test) %>%
do({
fit <- lm(Absorbance ~ Conc, data = .)
data.frame(
intercept = coef(fit)[1],
slope = coef(fit)[2],
r.squared = summary(fit)$r.squared,
Run_Time = unique(.$Run_Time)
)
}) %>%
ungroup()
View(stds_test)
reg_results <- stds %>%
group_by(Test) %>%
nest() %>%                                     # Nest each Test’s data
mutate(
model = map(data, ~ lm(Absorbance ~ Conc, data = .x)),         # Run lm()
tidy_model = map(model, tidy),                                 # Coefficients (slope, intercept)
glance_model = map(model, glance)                              # Summary (R², p, etc.)
)
reg_results <- stds %>%
group_by(Test) %>%
nest() %>%                                     # Nest each Test’s data
mutate(
model = map(data, ~ lm(Absorbance ~ Conc, data = .x)),         # Run lm()
tidy_model = map(model, tidy),                                 # Coefficients (slope, intercept)
glance_model = map(model, glance)                              # Summary (R², p, etc.)
)
stds_chk <- stds_combo %>%
group_by(Test) %>%
do({
mod <- lm(Absorbance ~ Conc, data = .)
summary_mod <- summary(mod)
data.frame(
slope = coef(mod)[["Conc"]],
intercept = coef(mod)[["(Intercept)"]],
r_squared = summary_mod$r.squared
)
}) %>%
ungroup()
View(stds_chk)
ggplot(stds, aes(x = Conc, y = Absorbance)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
facet_wrap(~ Test, scales = "free") +
theme_minimal()
std_curve <- ggplot(stds_combo, aes(x = Conc, y = Absorbance)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
facet_wrap(~ Test, scales = "free") +
theme_minimal()
std_curve
print(std_curve)
std_curve <- ggplot(stds_combo, aes(x = Conc, y = Absorbance)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
facet_wrap(~ Test, scales = "free") +
theme_minimal()
print(std_curve)
std_curve
print(std_curve)
stds_combo <- bind_rows(stds_NOx, stds_NH3, stds_PO4)
std_curve <- ggplot(stds_combo, aes(x = Conc, y = Absorbance)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
facet_wrap(~ Test, scales = "free") +
theme_minimal()
print(std_curve)
View(stds_combo)
std_curve <- ggplot(stds_combo, aes(x = Conc, y = Absorbance)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
#  facet_wrap(~ Test, scales = "free") +
theme_minimal()
print(std_curve)
print(std_curve)
head(stds_combo)
str(stds_combo)
#Plot standard Curve or Curves
std_curve <- ggplot(stds_combo, aes(x = Conc, y = Absorbance)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
#  facet_wrap(~ Test, scales = "free") +
theme_minimal()
print(std_curve)
